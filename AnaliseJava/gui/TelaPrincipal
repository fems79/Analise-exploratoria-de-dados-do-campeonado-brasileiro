package AnaliseJava.gui;

import AnaliseJava.Dados.AnalisadorDados;
import AnaliseJava.Dados.Partida;
import javax.swing.*;
import java.awt.*;
import java.io.File;
import java.io.IOException;
import java.util.List;
import java.util.Map;

public class TelaPrincipal extends JFrame {
    private PainelGrafico painelGrafico;

    public TelaPrincipal() {
        setTitle("AnÃ¡lise do Campeonato Brasileiro");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout());

        JButton btnCarregar = new JButton("Carregar CSV");
        btnCarregar.addActionListener(e -> carregarDados());
        
        JPanel painelSuperior = new JPanel();
        painelSuperior.add(btnCarregar);
        add(painelSuperior, BorderLayout.NORTH);

        painelGrafico = new PainelGrafico();
        add(new JScrollPane(painelGrafico), BorderLayout.CENTER);

        pack();
        setLocationRelativeTo(null);
    }

    private void carregarDados() {
        JFileChooser seletorArquivo = new JFileChooser();
        int resultado = seletorArquivo.showOpenDialog(this);
        if (resultado == JFileChooser.APPROVE_OPTION) {
            File arquivoSelecionado = seletorArquivo.getSelectedFile();
            try {
                List<Partida> partidas = AnalisadorDados.lerCsv(arquivoSelecionado.getAbsolutePath());
                Map<String, Integer> vitorias = AnalisadorDados.calcularVitoriasPorTime(partidas);
                painelGrafico.setDados(vitorias);
            } catch (IOException ex) {
                JOptionPane.showMessageDialog(this, "Erro ao ler o arquivo: " + ex.getMessage(), "Erro", JOptionPane.ERROR_MESSAGE);
            }
        }
    }
}
